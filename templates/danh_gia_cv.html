<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Đánh Giá CV - Job Assistant Agent</title>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        />
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/style.css') }}"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        />
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="/"
                    ><i class="fas fa-briefcase"></i> Job Assistant Agent</a
                >
                <button
                    class="navbar-toggler"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#navbarNav"
                >
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="/tim-viec">Tìm việc</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/viet-email"
                                >Viết email ứng tuyển</a
                            >
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/danh-gia-cv"
                                >Đánh giá CV</a
                            >
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/thong-ke-cong-ty"
                                >Thống kê công ty</a
                            >
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/tao-cv">Tạo CV</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container mt-5">
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <h1 class="mb-4">
                        <i class="fas fa-file-alt"></i> Đánh Giá CV
                    </h1>
                    <div class="card">
                        <div class="card-body">
                            <form id="cvForm">
                                <div class="mb-3">
                                    <label for="jobPosition" class="form-label"
                                        >Vị trí công việc mong muốn</label
                                    >
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="jobPosition"
                                        placeholder="VD: Frontend Developer, Marketing Manager..."
                                        required
                                    />
                                </div>
                                <div class="mb-3">
                                    <label for="cvContent" class="form-label"
                                        >Nội dung CV của bạn</label
                                    >
                                    <textarea
                                        class="form-control"
                                        id="cvContent"
                                        rows="10"
                                        placeholder="Dán toàn bộ nội dung CV của bạn vào đây..."
                                        required
                                    ></textarea>
                                </div>
                                <div class="d-grid">
                                    <button
                                        type="submit"
                                        class="btn btn-primary"
                                        id="analyzeButton"
                                    >
                                        <i class="fas fa-search"></i> Phân tích
                                        CV
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div
                        class="mt-4"
                        id="loadingIndicator"
                        style="display: none"
                    >
                        <div class="d-flex justify-content-center">
                            <div
                                class="spinner-border text-primary"
                                role="status"
                            >
                                <span class="visually-hidden"
                                    >Đang phân tích...</span
                                >
                            </div>
                        </div>
                        <p class="text-center mt-2">
                            Đang phân tích CV của bạn...
                        </p>
                    </div>

                    <div class="card mt-4" id="cvResult" style="display: none">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Kết quả đánh giá CV</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-4">
                                <h5>Điểm mạnh</h5>
                                <ul
                                    id="strengths"
                                    class="list-group list-group-flush"
                                ></ul>
                            </div>

                            <div class="mb-4">
                                <h5>Điểm yếu</h5>
                                <ul
                                    id="weaknesses"
                                    class="list-group list-group-flush"
                                ></ul>
                            </div>

                            <div class="mb-4">
                                <h5>Đề xuất cải thiện</h5>
                                <ul
                                    id="suggestions"
                                    class="list-group list-group-flush"
                                ></ul>
                            </div>

                            <div class="mb-4">
                                <h5>Đánh giá tổng thể</h5>
                                <div
                                    id="overallRating"
                                    class="p-3 bg-light rounded"
                                ></div>
                            </div>

                            <div class="mb-4">
                                <h5>Mức độ phù hợp với vị trí</h5>
                                <div class="progress">
                                    <div
                                        id="matchScore"
                                        class="progress-bar"
                                        role="progressbar"
                                        style="width: 0%"
                                        aria-valuenow="0"
                                        aria-valuemin="0"
                                        aria-valuemax="100"
                                    >
                                        0%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Mẹo tạo CV hiệu quả</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <i
                                        class="fas fa-check-circle text-success"
                                    ></i>
                                    Tùy chỉnh CV theo từng vị trí ứng tuyển
                                </li>
                                <li class="list-group-item">
                                    <i
                                        class="fas fa-check-circle text-success"
                                    ></i>
                                    Sử dụng từ khóa liên quan đến ngành nghề và
                                    vị trí
                                </li>
                                <li class="list-group-item">
                                    <i
                                        class="fas fa-check-circle text-success"
                                    ></i>
                                    Nhấn mạnh thành tích cụ thể với số liệu
                                </li>
                                <li class="list-group-item">
                                    <i
                                        class="fas fa-check-circle text-success"
                                    ></i>
                                    Giữ CV ngắn gọn, tối đa 2 trang
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="bg-light py-4 mt-5">
            <div class="container text-center">
                <p>Powered by LangGraph và OpenAI</p>
                <p class="text-muted">Job Assistant Agent © 2023</p>
            </div>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const cvForm = document.getElementById("cvForm");
                const loadingIndicator =
                    document.getElementById("loadingIndicator");
                const cvResult = document.getElementById("cvResult");

                cvForm.addEventListener("submit", function (e) {
                    e.preventDefault();

                    // Hiển thị loading
                    loadingIndicator.style.display = "block";
                    cvResult.style.display = "none";

                    // Lấy dữ liệu từ form
                    const jobPosition =
                        document.getElementById("jobPosition").value;
                    const cvContent =
                        document.getElementById("cvContent").value;

                    // Gọi API
                    fetch("http://127.0.0.1:8501/api/danh-gia-cv", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            job_position: jobPosition,
                            cv_content: cvContent,
                        }),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            // Ẩn loading
                            loadingIndicator.style.display = "none";
                            cvResult.style.display = "block";

                            // Hiển thị kết quả
                            if (data) {
                                // Hiển thị điểm mạnh
                                const strengthsList =
                                    document.getElementById("strengths");
                                strengthsList.innerHTML = "";
                                if (
                                    data.strengths &&
                                    data.strengths.length > 0
                                ) {
                                    data.strengths.forEach((strength) => {
                                        const li = document.createElement("li");
                                        li.className = "list-group-item";
                                        li.innerHTML = `<i class="fas fa-plus-circle text-success me-2"></i> ${strength}`;
                                        strengthsList.appendChild(li);
                                    });
                                }

                                // Hiển thị điểm yếu
                                const weaknessesList =
                                    document.getElementById("weaknesses");
                                weaknessesList.innerHTML = "";
                                if (
                                    data.weaknesses &&
                                    data.weaknesses.length > 0
                                ) {
                                    data.weaknesses.forEach((weakness) => {
                                        const li = document.createElement("li");
                                        li.className = "list-group-item";
                                        li.innerHTML = `<i class="fas fa-minus-circle text-danger me-2"></i> ${weakness}`;
                                        weaknessesList.appendChild(li);
                                    });
                                }

                                // Hiển thị đề xuất
                                const suggestionsList =
                                    document.getElementById("suggestions");
                                suggestionsList.innerHTML = "";
                                if (
                                    data.suggestions &&
                                    data.suggestions.length > 0
                                ) {
                                    data.suggestions.forEach((suggestion) => {
                                        const li = document.createElement("li");
                                        li.className = "list-group-item";
                                        li.innerHTML = `<i class="fas fa-lightbulb text-warning me-2"></i> ${suggestion}`;
                                        suggestionsList.appendChild(li);
                                    });
                                }

                                // Hiển thị đánh giá tổng thể
                                const overallRating =
                                    document.getElementById("overallRating");
                                if (data.overall_rating) {
                                    overallRating.textContent =
                                        data.overall_rating;
                                } else {
                                    overallRating.textContent =
                                        "Không có đánh giá tổng thể";
                                }

                                // Hiển thị điểm phù hợp
                                const matchScore =
                                    document.getElementById("matchScore");
                                if (data.match_score) {
                                    const score = parseInt(data.match_score);
                                    matchScore.style.width = `${score}%`;
                                    matchScore.textContent = `${score}%`;
                                    matchScore.setAttribute(
                                        "aria-valuenow",
                                        score
                                    );

                                    // Đổi màu dựa trên điểm số
                                    if (score < 40) {
                                        matchScore.className =
                                            "progress-bar bg-danger";
                                    } else if (score < 70) {
                                        matchScore.className =
                                            "progress-bar bg-warning";
                                    } else {
                                        matchScore.className =
                                            "progress-bar bg-success";
                                    }
                                } else {
                                    matchScore.style.width = "0%";
                                    matchScore.textContent = "N/A";
                                }
                            } else {
                                // Hiển thị thông báo lỗi
                                cvResult.innerHTML =
                                    '<div class="alert alert-warning">Không thể phân tích CV. Vui lòng thử lại với nội dung khác.</div>';
                            }
                        })
                        .catch((error) => {
                            console.error("Error:", error);
                            loadingIndicator.style.display = "none";
                            cvResult.style.display = "block";
                            cvResult.innerHTML =
                                '<div class="alert alert-danger">Có lỗi xảy ra khi phân tích CV. Vui lòng thử lại sau.</div>';
                        });
                });
            });
        </script>
    </body>
</html>
