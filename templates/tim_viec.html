<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Tìm việc - Job Assistant Agent</title>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        />
        <link
            rel="stylesheet"
            href="../static/css/style.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        />
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="/"
                    ><i class="fas fa-briefcase"></i> Job Assistant Agent</a
                >
                <button
                    class="navbar-toggler"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#navbarNav"
                >
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="/tim-viec"
                                >Tìm việc</a
                            >
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/viet-email"
                                >Viết email ứng tuyển</a
                            >
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/danh-gia-cv"
                                >Đánh giá CV</a
                            >
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/thong-ke-cong-ty"
                                >Thống kê công ty</a
                            >
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/tao-cv">Tạo CV</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container mt-5">
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <h1 class="mb-4"><i class="fas fa-search"></i> Tìm việc</h1>
                    <div class="card">
                        <div class="card-body">
                            <form id="jobSearchForm">
                                <div class="mb-3">
                                    <label
                                        for="jobDescription"
                                        class="form-label"
                                        >Mô tả công việc</label
                                    >
                                    <textarea
                                        class="form-control"
                                        id="jobDescription"
                                        rows="3"
                                        placeholder="Nhập mô tả công việc bạn muốn tìm..."
                                        required
                                    ></textarea>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="salary" class="form-label"
                                            >Mức lương</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="salary"
                                            placeholder="VD: 15-20 triệu"
                                        />
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="location" class="form-label"
                                            >Địa điểm</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="location"
                                            placeholder="VD: Hà Nội, TP.HCM"
                                        />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label
                                            for="experience"
                                            class="form-label"
                                            >Kinh nghiệm</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="experience"
                                            placeholder="VD: 2 năm, Fresher"
                                        />
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="jobType" class="form-label"
                                            >Loại công việc</label
                                        >
                                        <select
                                            class="form-select"
                                            id="jobType"
                                        >
                                            <option value="">Tất cả</option>
                                            <option value="Toàn thời gian">
                                                Toàn thời gian
                                            </option>
                                            <option value="Bán thời gian">
                                                Bán thời gian
                                            </option>
                                            <option value="Thực tập">
                                                Thực tập
                                            </option>
                                            <option value="Freelance">
                                                Freelance
                                            </option>
                                            <option value="Remote">
                                                Remote
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="d-grid">
                                    <button
                                        type="submit"
                                        class="btn btn-primary"
                                        id="searchButton"
                                    >
                                        <i class="fas fa-search"></i> Tìm kiếm
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div
                        class="mt-4"
                        id="loadingIndicator"
                        style="display: none"
                    >
                        <div class="d-flex justify-content-center">
                            <div
                                class="spinner-border text-primary"
                                role="status"
                            >
                                <span class="visually-hidden"
                                    >Đang tìm kiếm...</span
                                >
                            </div>
                        </div>
                        <p class="text-center mt-2">
                            Đang tìm kiếm công việc phù hợp...
                        </p>
                    </div>

                    <div
                        class="mt-4"
                        id="resultsContainer"
                        style="display: none"
                    >
                        <h2>Kết quả tìm kiếm</h2>
                        <div id="jobResults"></div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Mẹo tìm việc hiệu quả</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <i
                                        class="fas fa-check-circle text-success"
                                    ></i>
                                    Sử dụng từ khóa cụ thể trong mô tả công việc
                                </li>
                                <li class="list-group-item">
                                    <i
                                        class="fas fa-check-circle text-success"
                                    ></i>
                                    Xác định rõ mức lương mong muốn
                                </li>
                                <li class="list-group-item">
                                    <i
                                        class="fas fa-check-circle text-success"
                                    ></i>
                                    Nêu rõ kinh nghiệm và kỹ năng của bạn
                                </li>
                                <li class="list-group-item">
                                    <i
                                        class="fas fa-check-circle text-success"
                                    ></i>
                                    Tìm kiếm theo địa điểm phù hợp với nhu cầu
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="bg-light py-4 mt-5">
            <div class="container text-center">
                <p>Powered by LangGraph và OpenAI</p>
                <p class="text-muted">Job Assistant Agent © 2023</p>
            </div>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const jobSearchForm = document.getElementById("jobSearchForm");
                const loadingIndicator =
                    document.getElementById("loadingIndicator");
                const resultsContainer =
                    document.getElementById("resultsContainer");
                const jobResults = document.getElementById("jobResults");

                jobSearchForm.addEventListener("submit", function (e) {
                    e.preventDefault();

                    // Hiển thị loading
                    loadingIndicator.style.display = "block";
                    resultsContainer.style.display = "none";

                    // Lấy dữ liệu từ form
                    const jobDescription =
                        document.getElementById("jobDescription").value;
                    const salary = document.getElementById("salary").value;
                    const location = document.getElementById("location").value;
                    const experience =
                        document.getElementById("experience").value;
                    const jobType = document.getElementById("jobType").value;

                    // Gọi API
                    fetch("http://127.0.0.1:8501/api/tim-viec", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            job_description: jobDescription,
                            salary: salary,
                            location: location,
                            experience: experience,
                            job_type: jobType,
                        }),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            // Ẩn loading
                            loadingIndicator.style.display = "none";
                            resultsContainer.style.display = "block";

                            // Hiển thị kết quả
                            displayResults(data);
                        })
                        .catch((error) => {
                            console.error("Error:", error);
                            loadingIndicator.style.display = "none";
                            jobResults.innerHTML =
                                '<div class="alert alert-danger">Có lỗi xảy ra khi tìm kiếm. Vui lòng thử lại sau.</div>';
                            resultsContainer.style.display = "block";
                        });
                });

                function displayResults(data) {
                    jobResults.innerHTML = "";

                    if (!data || !data.jobs || data.jobs.length === 0) {
                        jobResults.innerHTML =
                            '<div class="alert alert-info">Không tìm thấy công việc phù hợp. Vui lòng thử lại với các tiêu chí khác.</div>';
                        return;
                    }

                    data.jobs.forEach((job, index) => {
                        const jobCard = document.createElement("div");
                        jobCard.className = "card mb-3";

                        const cardBody = document.createElement("div");
                        cardBody.className = "card-body";

                        const title = document.createElement("h5");
                        title.className = "card-title";
                        title.textContent = job.title || "Không có tiêu đề";

                        const company = document.createElement("h6");
                        company.className = "card-subtitle mb-2 text-muted";
                        company.innerHTML = `<i class="fas fa-building"></i> ${
                            job.company || "Không có thông tin công ty"
                        }`;

                        const details = document.createElement("div");
                        details.className = "mt-3";
                        details.innerHTML = `
                        <p><i class="fas fa-map-marker-alt"></i> <strong>Địa điểm:</strong> ${
                            job.location || "Không có thông tin"
                        }</p>
                        <p><i class="fas fa-money-bill-wave"></i> <strong>Mức lương:</strong> ${
                            job.salary || "Không có thông tin"
                        }</p>
                        <p><i class="fas fa-briefcase"></i> <strong>Loại công việc:</strong> ${
                            job.job_type || "Không có thông tin"
                        }</p>
                        <p><i class="fas fa-clock"></i> <strong>Kinh nghiệm:</strong> ${
                            job.experience || "Không có thông tin"
                        }</p>
                    `;

                        const description = document.createElement("div");
                        description.className = "mt-3";
                        description.innerHTML = `
                        <h6><strong>Mô tả công việc:</strong></h6>
                        <p>${job.description || "Không có mô tả"}</p>
                    `;

                        const requirements = document.createElement("div");
                        requirements.className = "mt-3";
                        requirements.innerHTML = `
                        <h6><strong>Yêu cầu:</strong></h6>
                        <p>${job.requirements || "Không có thông tin"}</p>
                    `;

                        const applyButton = document.createElement("a");
                        applyButton.href = "#";
                        applyButton.className = "btn btn-primary mt-3";
                        applyButton.innerHTML =
                            '<i class="fas fa-paper-plane"></i> Ứng tuyển ngay';
                        applyButton.onclick = function (e) {
                            e.preventDefault();
                            alert("Chức năng ứng tuyển đang được phát triển!");
                        };

                        cardBody.appendChild(title);
                        cardBody.appendChild(company);
                        cardBody.appendChild(details);
                        cardBody.appendChild(description);
                        cardBody.appendChild(requirements);
                        cardBody.appendChild(applyButton);

                        jobCard.appendChild(cardBody);
                        jobResults.appendChild(jobCard);
                    });
                }
            });
        </script>
    </body>
</html>
